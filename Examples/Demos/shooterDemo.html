<html>

<head>
    <script src="../Assets/dist/aframe-master.min.js"></script>
    <script src="../Assets/dist/aframe-environment-component.min.js"></script>
    <script src="../Assets/src/components/oculus-go-controls.js"></script>
    <script>
        AFRAME.registerComponent("camera-movement", {


            init: function () {
                let self = this;
                let data = this.data;
                let el = this.el;
                this.data.moving = false;
                let moving = this.data.moving;

                this.player = document.querySelector("a-camera");

                let axes = [0, 0];
                this.touchOnly = true;

                el.addEventListener("trackpaddown", function (event) {
                    // console.log("trackpad down");
                    //console.log(this.moving);
                    self.data.moving = true;

                    // console.log(this.moving);
                });

                el.addEventListener("trackpadup", function (event) {
                    // console.log("trackpad up");
                    // console.log(event);
                    self.data.moving = false;
                });

                window.addEventListener("mousedown", function (event) {
                    console.log("mousedown");
                    self.data.moving = true;
                    console.log(moving);
                });
                window.addEventListener("mouseup", function (event) {
                    console.log("mouseup");
                    self.data.moving = false;
                });

                // el.addEventListener("trackpadchanged", function(event) {
                //   console.log("trackpad changed");
                //   if (touchOnly){
                //     let pad = navigator.getGamepads().item(0);
                //     let newAxes = pad.axes;
                //     console.log(axes);
                //     console.log(newAxes);
                //   }
                // });

                // el.addEventListener("trackpadtouchstart", function(event, a, b, c, d){
                //   console.log("touchpad touch start");
                //   let pad = navigator.getGamepads().item(0);
                //   axes = pad.axes;
                //   touchOnly = true;
                // });

                // el.addEventListener("trackpadtouchend", function(event){
                //   console.log("touchpad touch end");
                //   if (touchOnly){
                //     let pad = navigator.getGamepads().item(0);
                //     let newAxes = pad.axes;
                //     console.log(axes);
                //     console.log(newAxes);
                //   }
                // });

                // // el.addEventListener("triggerchanged", function(event){
                // //   console.log("trigger changed");
                // //   console.log(event);
                // // });

                // el.addEventListener("trackpadmoved", function(event){
                //   console.log("moved");
                //   console.log(event);
                // });

                // el.addEventListener("triggerdown", function(event){
                //   console.log("trigger down");
                //   console.log(event);
                // });

                // el.addEventListener("triggerup", function(event){
                //   console.log("trigger up");
                //   console.log(event);
                // });

            },

            tick: function () {
                // console.log(this.data.moving);
                if (this.data.moving) {
                    // console.log("moving");
                    let wrapper = document.querySelector("#camera-wrapper");
                    // let wrapper = document.querySelector('a-entity[camera]').components.camera.camera;
                    // console.log(wrapper);
                    let angle = this.player.getAttribute("rotation");
                    let x = 0.05 * Math.cos((angle.y * Math.PI) / 180);
                    let y = 0.05 * Math.sin((angle.y * Math.PI) / 180);
                    let pos = wrapper.getAttribute("position");
                    pos.x -= y;
                    pos.z -= x;
                    wrapper.setAttribute("position", pos);
                    this.touchOnly = false;
                }
            }
        });
    </script>
    <script>
        AFRAME.registerComponent('bullet', {
            schema: {
                color: { default: '#f00' },
                size: { default: 0.2 },
                speed: { default: 0.1 },
            },

            init: function () {
                let el = this.el;
                let data = this.data;
                let camera = document.querySelector("#camera");
                let initPos = camera.getAttribute('position');
                //console.log(initPos);

                el.setAttribute("color", data.color);
                el.setAttribute('scale', { x: data.size, y: data.size, z: data.size });
                el.setAttribute('position', initPos);
                //console.log(el.getAttribute('position'));
            },

            tick: function () {
                let el = this.el;
                let data = this.data;
                let actPos = el.getAttribute('position');

                el.setAttribute('position', { x: actPos.x, y: actPos.y, z: actPos.z - data.speed });
                let camera = document.querySelector("#camera");

            }
        });


        document.querySelector('#leftHand').addEventListener('triggerdown', function (event) {
            console.log("click");
        });

    </script>
</head>

<body>
    <a-scene>
        <a-assets>
            <img id="boxTexture" src="../Assets/Images/cobble.jpg">
            <audio id="neigh" src="../Assets/Audio/thomas.mp3"></audio>
        </a-assets>


        <a-entity id="camera-wrapper" position="0 0 0">
            <a-camera id="camera" position="0 2 0"></a-camera>

            <a-entity camera-movement id="leftHand" laser-controls="hand: left" raycaster="objects: .collidable" line="color: #118A7E"></a-entity>
            <a-entity camera-movement id="rightHand" laser-controls="hand: right" raycaster="objects: .collidable" line="color: #118A7E"></a-entity>
        </a-entity>

        <a-sphere bullet></a-sphere>






        <a-entity environment="preset: forest; dressingAmount: 500"></a-entity>
        <a-sound src="#neigh" position="0 2 -5" autoplay="true" loop="true" preload="auto" volume="10"></a-sound>
    </a-scene>
</body>

</html>